<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CS 143</title>
  <link rel="stylesheet" href="https://unpkg.com/@antonz/codapi@0.20.0/dist/snippet.css">
  <script
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
  type="text/javascript"></script>
  <style>
    body { max-width: 48em; margin: 2em auto; padding: 0 1em; font-family: system-ui, sans-serif; line-height: 1.6; }
    pre { background: #f5f5f5; padding: 1em; overflow-x: auto; border-radius: 4px; }
    code { font-size: 0.95em; }
    table { border-collapse: collapse; border-spacing: 0; margin: 1em 0; }
    th, td { border: 1px solid #999; padding: 0.3em 0.8em; }
    codapi-output { line-height: 1.3; }
    codapi-snippet + .sourceCode { margin-top: 0.5em; }
    .sourceCode { margin-top: 0; margin-bottom: 0; }
  </style>
</head>
<body>
<script id="setup-basic" type="text/plain">
CREATE TABLE t (x int, y int);
INSERT INTO t VALUES (1, 5), (2, 4), (3, 3), (4, 2), (5, 1);
##CODE##
</script>
<script id="setup-agg" type="text/plain">
CREATE TABLE t (x int, y int);
INSERT INTO t VALUES (1, 5), (2, 4), (3, 3), (1, 2), (2, 1);
##CODE##
</script>
<h2 id="why-cs-143">Why CS 143?</h2>
<p>What’s the <a href="https://spectrum.ieee.org/the-rise-of-sql">most
popular programming language</a>?</p>
<p>How many databases are out there? (<a
href="https://sqlite.org/mostdeployed.html">1 trillion sqlite
DB</a>)</p>
<p>How old is the oldest DB? (<a
href="https://en.wikipedia.org/wiki/Kish_tablet">~3500 BC</a>, 5k years
old)</p>
<p>DB’s fun:</p>
<ul>
<li>Rite of passage of a systems hacker: write a compiler, write an OS,
write a DB</li>
<li>Beautiful <a href="http://webdam.inria.fr/Alice/">algorithms &amp;
theory</a></li>
</ul>
<h2 id="trying-things-out">Trying things out</h2>
<p><a href="https://sqlime.org">SQL playground</a></p>
<p>You might also have <code>sqlite</code> already installed on your
computer.</p>
<p>If running in terminal, remember to add semicolon <code>;</code> at
the end of each query.</p>
<p>First, <code>CREATE TABLE t (x int, y int)</code></p>
<p>Add data by
<code>INSERT INTO t VALUES (1, 5), (2, 4), (3, 3), (4, 2), (5, 1)</code></p>
<p>Check with <code>SELECT * FROM t</code> (<code>*</code> = all the
columns)</p>
<p>To remove rows, <code>DELETE FROM t WHERE x = 1 AND y = 5</code> (how
do you delete all rows?)</p>
<p>To remove table, <code>DROP TABLE t</code></p>
<h2 id="basic-sql">Basic SQL</h2>
<p>What do the following queries return given input?</p>
<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> x</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> t</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">WHERE</span> x <span class="op">&lt;</span> <span class="dv">3</span></span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<div class="sourceCode" id="cb2"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> x, y</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> t</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">WHERE</span> y <span class="op">&lt;</span> <span class="dv">3</span></span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<div class="sourceCode" id="cb3"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> x</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> t</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">WHERE</span> y <span class="op">&lt;</span> <span class="dv">3</span></span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<div class="sourceCode" id="cb4"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> x<span class="op">+</span><span class="dv">1</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> t</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">WHERE</span> y <span class="op">&lt;</span> <span class="dv">3</span></span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<div class="sourceCode" id="cb5"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> x<span class="op">+</span>y</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> t</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">WHERE</span> y <span class="op">&lt;</span> <span class="dv">3</span></span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<div class="sourceCode" id="cb6"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> x<span class="op">+</span>y</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> t</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">WHERE</span> <span class="kw">NOT</span> y <span class="op">&lt;</span> <span class="dv">3</span></span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<div class="sourceCode" id="cb7"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> x<span class="op">+</span>y</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> t</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">WHERE</span> y <span class="op">&lt;</span> <span class="dv">3</span> <span class="kw">AND</span> x <span class="op">&gt;</span> <span class="dv">1</span></span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<div class="sourceCode" id="cb8"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> x<span class="op">+</span>y</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> t</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">WHERE</span> y <span class="op">&lt;</span> <span class="dv">3</span> <span class="kw">OR</span> x <span class="op">&gt;</span> <span class="dv">1</span></span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<p>General form:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> e(x, y)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> <span class="kw">table</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">WHERE</span> cond(x, y)</span></code></pre></div>
<p>Meaning:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (x, y) <span class="kw">in</span> table:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> cond(x, y):</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(e(x, y))</span></code></pre></div>
<h2 id="aggregates">Aggregates</h2>
<div class="sourceCode" id="cb11"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">SUM</span>(x) <span class="kw">FROM</span> t</span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<div class="sourceCode" id="cb12"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">MIN</span>(x) <span class="kw">FROM</span> t</span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<div class="sourceCode" id="cb13"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">MAX</span>(x) <span class="kw">FROM</span> t</span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<div class="sourceCode" id="cb14"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(x) <span class="kw">FROM</span> t</span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<div class="sourceCode" id="cb15"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(x) <span class="kw">FROM</span> t</span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-basic"></codapi-snippet>
<p>Aggregate by groups:</p>
<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb16"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> <span class="op">..</span>.</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> t</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> x</span></code></pre></div>
<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
</tr>
</thead>
<tbody>
<tr>
<td>?</td>
<td>?</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
</tr>
</thead>
<tbody>
<tr>
<td>?</td>
<td>?</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
</tr>
</thead>
<tbody>
<tr>
<td>?</td>
<td>?</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb17"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> x, <span class="fu">SUM</span>(y)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> t</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> x</span></code></pre></div>
<codapi-snippet sandbox="sqlite" editor="basic" template="#setup-agg"></codapi-snippet>
<p><code>GROUP BY</code> variable (<code>x</code>) <strong>must</strong>
be <code>SELECT</code>ed, <code>AGG</code> function applied per
group.</p>
<p>Current general form:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>:   <span class="kw">SELECT</span> x, AGG(y)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>:     <span class="kw">FROM</span> t</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>:    <span class="kw">WHERE</span> cond(x, y)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>: <span class="kw">GROUP</span> <span class="kw">BY</span> x</span></code></pre></div>
<ol type="1">
<li>Where’s the data <code>FROM</code>?</li>
<li>Check conditions</li>
<li>Group rows</li>
<li>Run aggregate &amp; return</li>
</ol>
<h2 id="relational-algebra">Relational algebra</h2>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>Name</th>
<th>Notation</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>selection</td>
<td><span class="math inline">\(\sigma_p(t)\)</span></td>
<td>filter by condition <span class="math inline">\(p\)</span></td>
</tr>
<tr>
<td>projection</td>
<td><span class="math inline">\(\pi_{e(x, y)}(t)\)</span></td>
<td>evaluate an expression <span class="math inline">\(e\)</span> over
<span class="math inline">\(x, y\)</span> and return</td>
</tr>
<tr>
<td>aggregation</td>
<td><span class="math inline">\(\gamma_{x, F(y)}(t)\)</span></td>
<td>group by <span class="math inline">\(x\)</span>, aggregate over
<span class="math inline">\(y\)</span> using <span
class="math inline">\(F\)</span></td>
</tr>
</tbody>
</table>
<p>Can you write out SQL query for each operation?</p>
<script src="https://unpkg.com/@antonz/codapi@0.20.0/dist/snippet.js"></script>
</body>
</html>
